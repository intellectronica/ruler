# Ruler Project: Path to v0.2.0 (Beta)

This document outlines suggestions and an implementation plan to elevate the Ruler project to a v0.2.0 beta release. The focus is on improving robustness, stability, user interface (CLI), and comprehensive documentation to facilitate wider adoption.

## ðŸ”– At-a-Glance Checklist
- [ ] Create and switch to `feature/v0.2.0-beta` branch  
- [ ] Upgrade dependencies (TypeScript 5.x, eslint v*)  
- [ ] Standardise error messages  
- [ ] Implement verbose logging  
- [ ] Remove unused `generated/` directory logic  
- [ ] Increase test coverage (> 80 %)  
- [ ] Overhaul README  
- [ ] Validate `ruler.toml` via schema  
- [ ] Tag `v0.2.0-beta` and publish to npm

## I. Suggestions for Improvement

Here's a breakdown of areas with potential enhancements:

### 1. Code & Project Structure ðŸ—ï¸

* **Error Handling**:
    * **Standardise Error Messages**: Adopt a consistent format for error messages originating from Ruler, e.g., `[RulerError] Message. (Details: ...)`. This helps users quickly identify the source of problems and improves debuggability.
    * **Contextual File Errors**: Enhance error messages for file operations to include the problematic file path and the specific OS error. For example, instead of "File not found," use "Error reading file at '/path/to/your/.ruler/some_rule.md': File not found (ENOENT)."
* **Dependencies**:
    * **Review and Update**: The current dependencies are reasonably up to date. Consider updating TypeScript to v5.x for better performance and features. The TypeScript ESLint packages should be updated to match.
    * **`package-lock.json` Synchronisation**: The current `package-lock.json` is already at version `0.1.4`, matching `package.json`.
* **`package.json` Scripts**:
    * **Add Test Coverage Script**: Include `"test:coverage": "jest --coverage"` to easily generate and review code coverage reports.
    * **Add Watch Mode Script**: Include `"test:watch": "jest --watch"` for development convenience.
* **`tsconfig.json`**:
    * **Declaration Files**: Consider enabling `"declaration": true` and `"declarationMap": true`. While Ruler is primarily a CLI, generating type definitions can be beneficial for internal consistency and potential future library use.
* **Unused `generated` Directory**:
    * The `lib.ts` file includes `await FileSystemUtils.ensureDirExists(path.join(rulerDir, 'generated'));`. This appears to be vestigial and should be removed to avoid confusion.
* **Logging**:
    * **Verbose Mode**: Implement a `--verbose` flag that provides detailed logging for debugging user configurations. This is particularly useful for understanding agent selection logic and file operations.
* **Agent Names Consistency**:
    * The codebase uses various naming conventions for agents (e.g., "GitHub Copilot" vs "GitHubCopilot"). Standardize on the display names used in agent implementations.

---
### 2. CLI Interface (User Experience) ðŸ’»

* **`--version` Flag**: Verify that `ruler --version` correctly outputs the version from `package.json`.
* **`--verbose` / `-v` Flag**: Implement for the `apply` command to enable detailed logging.
* **Output Clarity**:
    * **Success Messages**: Currently uses checkmarks (âœ“) which is good. Consider adding file paths for clarity.
    * **Error Messages**: Ensure all errors include actionable next steps.
    * **Dry Run Mode**: Consider adding `--dry-run` flag to preview what would be changed without actually writing files.

---
### 3. Configuration (`ruler.toml`) âš™ï¸

* **Schema Documentation**: Create a comprehensive example `ruler.toml` with all possible options documented.
* **Validation**: Add schema validation for `ruler.toml` to catch configuration errors early.
* **Agent Name Matching**: Document that agent names in config use case-insensitive substring matching.

---
### 4. Testing Strategy ðŸ§ª

* **Current Test Coverage**: The project already has good test coverage with unit and e2e tests.
* **Additional Test Scenarios**:
    * **Config Precedence**: Test complex scenarios where CLI flags, config file, and defaults interact.
    * **Concurrent Runs**: Test behavior when `ruler apply` is run multiple times simultaneously.
    * **Large Projects**: Test performance with many rule files or large rule files.
* **Integration Tests**: Add tests that verify the actual agent configuration files work with their respective tools (at least structurally).

---
### 5. README.md Overhaul (Major Focus) ðŸ“–

The README needs to be more comprehensive and user-friendly, with better examples and clearer organization.

**(See dedicated section "II. Proposed README.md Structure & Content" below for the full detailed structure.)**

---
## II. Proposed README.md Structure & Content

Hereâ€™s a blueprint for a more robust `README.md`:

1.  **Project Logo/Banner** (Optional, but enhances visual appeal)
2.  **Badges**:
    * CI Status (e.g., `![CI](https://github.com/intellectronica/ruler/actions/workflows/ci.yml/badge.svg)`)
    * NPM Version (e.g., `[![npm version](https://badge.fury.io/js/%40intellectronica%2Fruler.svg)](https://badge.fury.io/js/%40intellectronica%2Fruler)`)
    * License (e.g., `![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)`)
    * Code Coverage (once set up, e.g., from Codecov or Coveralls)
    * Downloads (optional: `[![npm downloads](https://img.shields.io/npm/dm/%40intellectronica%2Fruler.svg)](https://www.npmjs.com/package/%40intellectronica%2Fruler)`)
3.  **Ruler: Centralise Your AI Coding Assistant Instructions**
    * Short, compelling tagline.
4.  **Introduction: Why Ruler?**
    * Clearly articulate the problem: managing inconsistent or duplicated instructions across multiple AI coding tools (Copilot, Claude, Aider, Cursor, etc.).
    * Present Ruler as the solution: a single, project-specific source of truth for AI agent instructions.
    * List key benefits: consistency, easier updates, improved AI responses through better context, streamlined project onboarding for AI tools.
5.  **Core Features**
    * **Centralised Rule Management**: Store all AI instructions in a dedicated `.ruler/` directory using Markdown files.
    * **Automatic Distribution**: Ruler applies these rules to configuration files of supported AI agents.
    * **Targeted Agent Configuration**: Fine-tune which agents are affected and their specific output paths via `ruler.toml`.
    * **MCP Server Propagation**: Manage and distribute Model Context Protocol (MCP) server settings.
    * **`.gitignore` Automation**: Keeps generated agent config files out of version control automatically.
    * **Simple CLI**: Easy-to-use commands for initialising and applying configurations.
    * **Extensible Architecture**: (Briefly mention the design allows for new agent adapters).
6.  **Supported AI Agents**
    * Use the existing table. Ensure it's accurate and lists all currently supported agents and the files Ruler manages for them.
7.  **Getting Started**
    * **Prerequisites**: Node.js (specify version range, e.g., >=18.x).
    * **Installation**:
        * **Global (Recommended for CLI use)**:
            ```bash
            npm install -g @intellectronica/ruler
            ```
        * **Using `npx` (for one-off commands or project-local execution)**:
            ```bash
            npx @intellectronica/ruler apply
            ```
    * **Project Initialisation**:
        * Navigate to your project's root directory.
        * Run `ruler init`.
        * Explain that this creates:
            * `.ruler/` directory.
            * `.ruler/instructions.md`: A starter Markdown file for your rules.
            * `.ruler/ruler.toml`: The main configuration file for Ruler.
            * `.ruler/mcp.json`: An example MCP server configuration.
        * Showcase the default content of `instructions.md` and `ruler.toml` as examples.
8.  **Core Concepts**
    * **The `.ruler/` Directory**: Explain this is the central hub.
        * **Rule Files (`*.md`)**: How they are discovered (recursively from `.ruler/`) and alphabetically concatenated. Emphasise that breaking rules into multiple, logically named `.md` files is encouraged (e.g., `coding_style.md`, `project_architecture.md`).
        * **Concatenation Marker**: Explain that each file's content in the final concatenated ruleset is prepended with `--- Source: <relative_path_to_md_file> ---` for traceability.
        * **`ruler.toml`**: Its role as the master configuration for Ruler's behavior, agent selection, and output paths.
        * **`mcp.json`**: Its role for defining shared MCP server settings.
9.  **Usage: The `apply` Command**
    * Primary command: `ruler apply [options]`
    * Detailed breakdown of each option:
        * `--project-root <path>`: Path to your project's root. Defaults to the current directory.
        * `--agents <agent1,agent2,...>`: Comma-separated list of agent names (or case-insensitive substrings like "copilot", "claude") to apply rules to. Overrides `default_agents` in `ruler.toml`.
        * `--config <path>`: Path to a custom `ruler.toml` configuration file.
        * `--mcp` / `--with-mcp`: (Default: true) Enable applying MCP server configurations.
        * `--no-mcp`: Disable applying MCP server configurations.
        * `--mcp-overwrite`: (Default: false) If MCP is applied, this flag makes Ruler overwrite the native MCP config entirely, instead of merging.
        * `--gitignore`: (Default: true) Enable automatic updates to `.gitignore`.
        * `--no-gitignore`: Disable automatic updates to `.gitignore`.
        * `--verbose` / `-v`: Display more detailed output during execution.
    * **Common Examples**:
        * Apply rules to all configured agents: `ruler apply`
        * Apply rules only to GitHub Copilot and Claude: `ruler apply --agents copilot,claude`
        * Use a specific configuration file: `ruler apply --config ./team-configs/ruler.frontend.toml`
        * Apply rules but skip MCP and `.gitignore` updates: `ruler apply --no-mcp --no-gitignore`
10. **Configuration (`ruler.toml`) in Detail**
    * **Location**: Defaults to `.ruler/ruler.toml` in the project root. Can be overridden by the `--config` CLI option.
    * **Complete Example with All Options**:
        ```toml
        # Default agents to run when --agents is not specified
        # Uses case-insensitive substring matching
        # If omitted, all enabled agents run
        default_agents = ["GitHub Copilot", "Claude", "Aider"]

        # --- Global MCP Server Configuration ---
        [mcp]
        # Enable/disable MCP propagation globally (default: true)
        enabled = true
        # Global merge strategy: 'merge' or 'overwrite' (default: 'merge')
        merge_strategy = "merge"

        # --- Global .gitignore Configuration ---
        [gitignore]
        # Enable/disable automatic .gitignore updates (default: true)
        enabled = true

        # --- Agent-Specific Configurations ---
        # Use the agent's display name or any case-insensitive substring
        # Common agent names: "GitHub Copilot", "Claude Code", "OpenAI Codex CLI",
        # "Cursor", "Windsurf", "Cline", "Aider"

        [agents."GitHub Copilot"]
        enabled = true
        output_path = ".github/copilot-instructions.md"  # Default path

        [agents.Claude]
        enabled = true
        output_path = "CLAUDE.md"  # Default path

        [agents.Aider]
        enabled = true
        # Aider has two output files
        output_path_instructions = "ruler_aider_instructions.md"
        output_path_config = ".aider.conf.yml"
        
        # Agent-specific MCP configuration
        [agents.Cursor.mcp]
        enabled = true
        merge_strategy = "merge"  # Override global strategy for this agent

        # Disable specific agents
        [agents.Windsurf]
        enabled = false
        ```
    * **Configuration Precedence Rules**: Clearly state the order:
        1.  CLI flags (e.g., `--agents`, `--no-mcp`, `--mcp-overwrite`, `--no-gitignore`).
        2.  Settings in `ruler.toml` (`default_agents`, specific agent settings, global `[mcp]` and `[gitignore]` sections).
        3.  Ruler's built-in defaults (e.g., all agents enabled, standard output paths, MCP enabled with 'merge', gitignore enabled).
11. **Managing Rules (`.ruler/*.md`)**
    * **Best Practices**:
        * **Granularity**: Break down complex instructions into multiple, focused `.md` files (e.g., `style_guide.md`, `api_conventions.md`, `common_pitfalls.md`, `project_context_for_ai.md`). Ruler sorts these alphabetically by full path before concatenation.
        * **Clarity**: Use standard Markdown formatting (headings, lists, code blocks) for readability within your rule files. The AI agents will receive the raw concatenated text.
        * **AI-Friendliness**: Write rules clearly and directly, as if you were instructing a junior developer who is also an AI.
    * **Example Rule File (`.ruler/python_guidelines.md`)**:
        ```markdown
        # Python Project Guidelines

        ## General Style
        - Follow PEP 8 for all Python code.
        - Use type hints for all function signatures and complex variables.
        - Keep functions short and focused on a single task.

        ## Error Handling
        - Use specific exception types rather than generic `Exception`.
        - Log errors effectively with context.

        ## Security
        - Always validate and sanitize user input.
        - Be mindful of potential injection vulnerabilities, especially with database queries or external commands.
        ```
12. **MCP (Model Context Protocol) Server Configuration**
    * **(Optional: Briefly explain MCP if you have a simple definition, or state it's an advanced feature for tools that support it for providing broader context to AI models.)**
    * **`.ruler/mcp.json`**: How to define server configurations. Show the example from `ruler init`:
        ```json
        {
          "mcpServers": {
            "example": {
              "url": "[https://mcp.example.com](https://mcp.example.com)"
            }
          }
        }
        ```
    * Explain how Ruler uses this file with the `merge` (default) or `overwrite` strategy, controlled by `ruler.toml` or CLI flags.
13. **`.gitignore` Integration**
    * Ruler helps keep your repository clean by automatically adding the paths of generated agent configuration files to your project's `.gitignore`.
    * **How it Works**: It adds paths to a special block marked with `# START Ruler Generated Files` and `# END Ruler Generated Files`. Existing content outside this block is preserved.
    * **Example `.gitignore` section**:
        ```gitignore
        # Other user-defined rules
        node_modules/
        *.log

        # START Ruler Generated Files
        .aider.conf.yml
        .clinerules
        .cursor/rules/ruler_cursor_instructions.md
        .github/copilot-instructions.md
        .windsurf/rules/ruler_windsurf_instructions.md
        AGENTS.md
        CLAUDE.md
        ruler_aider_instructions.md
        # END Ruler Generated Files

        dist/
        ```
    * Reiterate control via CLI flags (`--gitignore`, `--no-gitignore`) and `ruler.toml` (`[gitignore].enabled`).
14. **Practical Usage Scenarios & Workflow Integration**
    * **Scenario 1: Getting Started Quickly**
        ```bash
        # Initialize Ruler in your project
        cd your-project
        ruler init
        
        # Edit the generated files
        # - Add your coding guidelines to .ruler/instructions.md
        # - Customize .ruler/ruler.toml if needed
        
        # Apply rules to all AI agents
        ruler apply
        ```
    
    * **Scenario 2: Team Standardization**
        * Create `.ruler/coding_standards.md`, `.ruler/api_usage.md`.
        * Commit the `.ruler` directory (including `ruler.toml` if customized) to your team's repository.
        * Team members pull changes and run `ruler apply` to update their local AI agent configurations.
    * **Scenario 3: Project-Specific Context for AI**
        * In `.ruler/project_overview.md`, detail the project's architecture, key libraries, and common patterns.
        * In `.ruler/data_models.md`, describe primary data structures.
        * Run `ruler apply`. This helps AI tools provide more relevant suggestions.
    * **Integration with NPM Scripts (for Node.js projects)**:
        ```json
        // package.json
        "scripts": {
          "ruler:apply": "ruler apply",
          "dev": "npm run ruler:apply && your_dev_command",
          // Optional: Add to pre-commit hook using husky
          "prepare": "husky install || true", // Ensure husky is set up
          "precommit": "npm run ruler:apply && git add ." // Example, adjust git add if needed
        }
        ```
        *To use with Husky for pre-commit hooks:*
        1. Install Husky: `npm install husky --save-dev`
        2. Initialize Husky: `npx husky install`
        3. Add hook: `npx husky add .husky/pre-commit "npm run ruler:apply && git add .github/copilot-instructions.md CLAUDE.md etc."` (List files Ruler generates, or use `git add .` cautiously).
    * **Integration with GitHub Actions (CI/CD)**:
        * **Simplified Check**: Ensure rules are applied before merging
        ```yaml
        # .github/workflows/ruler-check.yml
        name: Check Ruler Configuration
        on:
          pull_request:
            paths:
              - '.ruler/**'
              - 'package.json'  # In case Ruler version changes
        
        jobs:
          check-ruler:
            runs-on: ubuntu-latest
            steps:
              - uses: actions/checkout@v4
              
              - uses: actions/setup-node@v4
                with:
                  node-version: '18'
                  cache: 'npm'
              
              - name: Install Ruler
                run: npm install -g @intellectronica/ruler
              
              - name: Apply Ruler configuration
                run: ruler apply --no-gitignore  # Don't modify .gitignore in CI
              
              - name: Check for uncommitted changes
                run: |
                  if [[ -n $(git status --porcelain) ]]; then
                    echo "::error::Ruler configuration is out of sync!"
                    echo "Please run 'ruler apply' locally and commit the changes."
                    git status --short
                    git diff
                    exit 1
                  fi
        ```

15. **Troubleshooting**
    * **Common Issues**:
        * **"Cannot find module" errors**: Ensure Ruler is installed globally (`npm install -g @intellectronica/ruler`) or use `npx`.
        * **Permission denied errors**: On Unix systems, you may need to use `sudo` for global installation.
        * **Agent files not updating**: Check if the agent is enabled in `ruler.toml` and not excluded by `--agents` flag.
    * **Debug Mode**: Use `--verbose` flag to see detailed execution logs.
    * **Configuration Validation**: Run `ruler validate` (future feature) to check your configuration.

16. **FAQ**
    * **Q: Can I use different rules for different agents?**
      A: Currently, all agents receive the same concatenated rules. For agent-specific instructions, include sections in your rule files like "## GitHub Copilot Specific" or "## Aider Configuration".
    
    * **Q: How do I temporarily disable Ruler for an agent?**
      A: Set `enabled = false` in `ruler.toml` under `[agents.AgentName]`, or use `--agents` flag to specify only the agents you want.
    
    * **Q: What happens to my existing agent configuration files?**
      A: Ruler creates backups with `.bak` extension before overwriting any existing files.

<!-- ...existing content... -->

---
## III. Step-by-Step Implementation Plan for v0.2.0 Beta

This plan is designed for a developer to follow, with clear priorities and realistic scope.

**Branch Name**: `feature/v0.2.0-beta`

### Phase 0: Setup & Preparation

1. **Create Feature Branch**:
   ```bash
   git checkout main
   git pull origin main
   git checkout -b feature/v0.2.0-beta
   ```

2. **Version Bump**:
   * Update `version` in `package.json` to `0.2.0`
   * Update `version` in `package-lock.json` to match
   * Commit: `git commit -m "chore: bump version to 0.2.0"`

### Phase 0.5: Dependency Upgrades (â³ ~1 h, ðŸŸ¢ low risk)
1. `npm outdated` â€“ review major versions.  
2. Upgrade **TypeScript** to `^5.x` and align eslint / ts-eslint packages.  
3. Run `npm install` and fix any compilation issues.  
4. Commit: `build: upgrade TypeScript 5 and related tooling`.

### Phase 1: Core Improvements (â³ ~4 h, ðŸ”´ high priority)
- [ ] **Standardise Error Messages**
  - Files: `src/lib.ts`, `src/cli/commands.ts`, `src/core/ConfigLoader.ts`
  - Prefix constant: `const ERROR_PREFIX = '[RulerError]'`
- [ ] **Add Verbose Logging**
  - Flag `--verbose/-v` in `src/cli/commands.ts`
  - Propagate to library code
- [ ] **Remove Unused Code**
  - Delete `ensureDirExists(.../generated)` call in `src/lib.ts`

### Phase 2: Testing & Quality (â³ ~3 h)
- [ ] Add scripts `test:coverage`, `test:watch` to `package.json`
- [ ] Create tests:
  - `tests/unit/core/ConfigPrecedence.test.ts`
  - `tests/unit/cli/VerboseOutput.test.ts`
- [ ] Target overall coverage â‰¥ 80 %

### Phase 3: Documentation (Critical, â³ ~2 h)
- [ ] Rewrite `README.md` following proposed structure
- [ ] Generate `.ruler/example.ruler.toml`

### Phase 4: Configuration Enhancements (â³ ~2 h)
- [ ] Add schema validation with `zod` in `ConfigLoader.ts`
- [ ] Ensure consistent agent display names

### Phase 5: CLI Enhancements (Optional, â³ ~1.5 h)
- [ ] Implement `--dry-run` flag

### Phase 6: Manual QA & Polishing (â³ ~2 h)
- [ ] Run full command matrix (see original checklist)
- [ ] Verify error handling and verbose output

### Phase 7: Release & Publish (â³ ~45 min)
1. Update `CHANGELOG.md`.
2. Bump version to `0.2.0-beta` (if not already).  
3. `npm run build && npm test` (all green).  
4. Commit: `chore(release): 0.2.0-beta`.  
5. Tag: `git tag v0.2.0-beta && git push --tags`.  
6. Publish: `npm publish --tag beta`.

### Commit Strategy
Use **Conventional Commits**:  
`feat:`, `fix:`, `docs:`, `test:`, `chore:`, `refactor:`, `build:` (for dependency or tooling updates).

### Success Criteria for v0.2.0
- [ ] All error messages follow consistent format
- [ ] Verbose mode provides helpful debugging info
- [ ] README is comprehensive and user-friendly
- [ ] Test coverage > 80%
- [ ] All CLI options are documented
- [ ] Manual testing checklist passes
- [ ] CI/CD pipeline passes

This plan prioritizes the most impactful changes while keeping scope realistic for a beta release.